# Optical Wheel Detection - Visual Setup Guide

## ğŸ“ Physical Setup Diagram

```
                    OPTICAL DETECTION SETUP
                    
                                                
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘         iPhone (Front View)       â•‘
        â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
        â•‘  â”‚                             â”‚  â•‘
        â•‘  â”‚  â—‰ ğŸ“· Front Camera          â”‚  â•‘  â† Camera must
        â•‘  â”‚                             â”‚  â•‘    face wheel
        â•‘  â”‚         Display             â”‚  â•‘
        â•‘  â”‚                             â”‚  â•‘
        â•‘  â”‚                             â”‚  â•‘
        â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                      â†‘
                      â”‚
                  5-15 cm
                      â”‚
                      â†“
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘           WHEEL (Front View)         â•‘
        â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
        â•‘        â•±                 â•²           â•‘
        â•‘       â”‚    â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘    â”‚          â•‘
        â•‘       â”‚   â–‘           â–‘   â”‚          â•‘
        â•‘      â”‚    â–‘ Dark Wheel â–‘    â”‚        â•‘
        â•‘      â”‚     â–‘         â–‘      â”‚        â•‘
        â•‘      â”‚      â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘       â”‚        â•‘  â† Wheel with
        â•‘      â”‚       â•”â•â•â•â•â•â•—        â”‚        â•‘    opening
        â•‘      â”‚       â•‘     â•‘        â”‚        â•‘
        â•‘      â”‚       â•‘     â•‘ â†â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Opening
        â•‘      â”‚       â•‘     â•‘        â”‚        â•‘    (light passes)
        â•‘      â”‚       â•šâ•â•â•â•â•â•        â”‚        â•‘
        â•‘       â”‚      â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘      â”‚        â•‘
        â•‘        â”‚    â–‘         â–‘    â”‚         â•‘
        â•‘         â•²   â–‘         â–‘   â•±          â•‘
        â•‘          â•²   â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â•±           â•‘
        â•‘           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
        â•‘                                       â•‘
        â•‘         Attached to Moving Object     â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ”„ Detection Cycle

```
ROTATION DETECTION STATE MACHINE

State 1: Ready for New Rotation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wheel Opening is Visible       â”‚
â”‚  Brightness > HIGH threshold    â”‚
â”‚  âœ“ Camera can see through       â”‚
â”‚  âœ“ Flashlight reflects back     â”‚
â”‚  Status: READY âšª                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Wheel rotates...
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wheel Body Blocks Camera       â”‚
â”‚  Brightness < LOW threshold     â”‚
â”‚  âœ— Camera view blocked          â”‚
â”‚  âœ— Flashlight blocked           â”‚
â”‚  ğŸ”„ ROTATION DETECTED! +1       â”‚
â”‚  Status: TRIGGERED ğŸ”´            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Wheel continues...
            â†“
State 1: Ready for New Rotation
(Cycle repeats)
```

## ğŸ“Š Brightness Timeline

```
BRIGHTNESS OVER TIME (One Complete Rotation)

1.0  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚            â”‚     â”‚
     â”‚            â”‚     â”‚              HIGH threshold â”€â”€â”€â”€â”€
0.6  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚            â”‚     â”‚
     â”‚            â”‚     â”‚
     â”‚            â””â”€â”€â”€â”€â”€â”˜              LOW threshold â”€â”€â”€â”€â”€
0.3  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚
     â”‚    [Visible] [Blocked] [Visible]
0.0  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Time â†’

     â†‘            â†‘     â†‘
     â”‚            â”‚     â”‚
   Ready      Detect  Ready
                +1
```

## ğŸ¨ Wheel Design Examples

### Good Designs âœ…

```
Option 1: Single Opening
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•± â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â•²
  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
  â”‚  â–‘â–‘DARKâ–‘â–‘â–‘â–‘â–‘â–‘  â”‚
  â”‚  â–‘â–‘WHEELâ–‘â–‘â–‘â–‘   â”‚
  â”‚  â–‘â–‘â–‘â•”â•â•â•â•—â–‘â–‘â–‘   â”‚
  â”‚  â–‘â–‘â–‘â•‘   â•‘â–‘â–‘â–‘   â”‚ â† 25-35% opening
  â”‚  â–‘â–‘â–‘â•‘   â•‘â–‘â–‘â–‘   â”‚
  â”‚  â–‘â–‘â–‘â•šâ•â•â•â•â–‘â–‘â–‘   â”‚
  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚
   â•² â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Option 2: Contrasting Sections
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•± â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â•²
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•â•â•—â–ˆâ–ˆ  â”‚
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ â•‘â–‘â–‘â–‘â•‘â–ˆâ–ˆ  â”‚ â† Light opening
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ â•‘â–‘â–‘â–‘â•‘â–ˆâ–ˆ  â”‚    Dark body
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ â•‘â–‘â–‘â–‘â•‘â–ˆâ–ˆ  â”‚    High contrast
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•šâ•â•â•â•â–ˆâ–ˆ  â”‚
   â•² â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Option 3: Spoke Wheel
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•±  â•²    |    â•±  â•²
  â”‚    â•²   |   â•±    â”‚
  â”‚â”€â”€â”€â”€â”€â•²  |  â•±â”€â”€â”€â”€â”€â”‚ â† Use ONE spoke
  â”‚      â•² | â•±      â”‚    as trigger
  â”‚â”€â”€â”€â”€â”€â”€â”€â•²|â•±â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â•±|\â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚      â•± | â•²      â”‚
  â”‚â”€â”€â”€â”€â”€â•±  |  â•²â”€â”€â”€â”€â”€â”‚
   â•²    â•±   |   â•²   â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### Bad Designs âŒ

```
Too Many Openings (confusing)
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•± â–‘â•”â•—â–‘â•”â•—â–‘â•”â•—â–‘â•”â•— â•²
  â”‚  â–‘â•‘â•‘â–‘â•‘â•‘â–‘â•‘â•‘â–‘â•‘â•‘  â”‚ â† Too many triggers
  â”‚  â–‘â•šâ•â–‘â•šâ•â–‘â•šâ•â–‘â•šâ•  â”‚    per rotation
   â•² â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

No Contrast (unreliable)
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•± â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â•²
  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚ â† All same shade
  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚    No clear trigger
   â•² â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Opening Too Small (missed)
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   â•± â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â•²
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚ â† Opening too small
  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ â–ª â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚    May miss detections
   â•² â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â•±
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

## ğŸ”¦ Flashlight Behavior

```
FLASHLIGHT AUTO-MANAGEMENT

App State           Flashlight
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Magnetic Mode   â†’   OFF ğŸ’¡
                    (not needed)

Switch to       â†’   Requesting
Optical Mode        permission...

Optical Mode    â†’   ON ğŸ”¦
Active              (50% power)

Calibrating     â†’   ON ğŸ”¦
                    (collecting data)

App Background  â†’   OFF ğŸ’¡
                    (conserve battery)

App Foreground  â†’   ON ğŸ”¦
(Optical Mode)      (resume detection)

Switch to       â†’   OFF ğŸ’¡
Magnetic Mode       (no longer needed)
```

## ğŸ“± Settings UI Walkthrough

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ Settings                       Done  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Wheel Detection Method                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚  Magnetic    â”‚  Optical    âœ“    â”‚    â”‚ â† Toggle here
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚ â„¹ï¸ Optical Detection                    â”‚
â”‚ Uses the front camera and flashlight    â”‚
â”‚ to detect wheel rotations...            â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Calibration                             â”‚
â”‚                                         â”‚
â”‚ Current Brightness         0.532        â”‚ â† Real-time
â”‚ Low Threshold             0.325         â”‚
â”‚ High Threshold            0.675         â”‚
â”‚ ğŸ”¦ Flashlight is ON                     â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Start Calibration (10s)           â”‚ â”‚ â† Main button
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ğŸ‘ï¸ View Camera Preview            â”‚ â”‚ â† Preview
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Debug Info                              â”‚
â”‚                                         â”‚
â”‚ Current Brightness:        0.532        â”‚
â”‚ Rotations Detected:        42           â”‚
â”‚ Camera Status:        â— Active          â”‚
â”‚                                         â”‚
â”‚ Brightness Level:                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘|         |              â”‚ â”‚
â”‚ â”‚<---DARK---|--MID----|---BRIGHT---->â”‚ â”‚
â”‚ â”‚         Red       Green             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â†‘                                     â”‚
â”‚  Current brightness (blue bar)         â”‚
â”‚  Red marker = Low threshold            â”‚
â”‚  Green marker = High threshold         â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¸ Camera Preview Screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Done                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚   Optical Detection Setup               â”‚
â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                 â”‚  â”‚
â”‚   â”‚         ğŸ“·                      â”‚  â”‚
â”‚   â”‚                                 â”‚  â”‚
â”‚   â”‚   Position the phone so the    â”‚  â”‚
â”‚   â”‚   wheel opening blocks          â”‚  â”‚
â”‚   â”‚   the camera                    â”‚  â”‚
â”‚   â”‚                                 â”‚  â”‚
â”‚   â”‚   Current Brightness            â”‚  â”‚
â”‚   â”‚       0.532                     â”‚  â”‚ â† Live value
â”‚   â”‚                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚   Low: 0.325           High: 0.675     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘|         |            â”‚  â”‚ â† Visual bar
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚   â— Detecting: 42 rotations             â”‚
â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚           Done                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Calibration Process Visual

```
CALIBRATION WORKFLOW

Step 1: Prepare
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mount phone      â”‚
â”‚ Position wheel   â”‚
â”‚ Open Settings    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Step 2: Start Calibration
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tap "Start       â”‚
â”‚ Calibration"     â”‚
â”‚                  â”‚
â”‚ ğŸ”¦ ON            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Step 3: Rotate Wheel (10 seconds)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Brightness Samples
â”‚  Rotation 1  âŸ²   â”‚ â†’ [0.8, 0.3, 0.9, 0.2, ...]
â”‚  Rotation 2  âŸ²   â”‚ â†’ [0.7, 0.3, 0.8, 0.3, ...]
â”‚  Rotation 3  âŸ²   â”‚ â†’ [0.9, 0.2, 0.8, 0.3, ...]
â”‚  Rotation 4  âŸ²   â”‚ â†’ [0.8, 0.3, 0.9, 0.2, ...]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Step 4: Analysis
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sort samples     â”‚
â”‚ Calculate P25    â”‚ â†’ Low Threshold
â”‚ Calculate P75    â”‚ â†’ High Threshold
â”‚ Add margins      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Step 5: Complete âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Thresholds saved â”‚
â”‚ Ready to use     â”‚
â”‚ ğŸ”¦ Still ON      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¬ How Detection Works (Technical)

```
FRAME PROCESSING PIPELINE

Camera Frame (640x480)
        â†“
Extract Center ROI (30%)
        â†“
Sample Pixels (every 2nd)
        â†“
Calculate RGB â†’ Brightness
(0.299R + 0.587G + 0.114B)
        â†“
Normalize (0.0 - 1.0)
        â†“
Add to History Buffer
        â†“
Compare with Thresholds
        â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â†“       â†“
< LOW    > HIGH
threshold threshold
    â†“       â†“
BLOCKED  VISIBLE
    â†“       â†“
  +1      READY
Rotation
```

## ğŸ’¾ Data Flow Architecture

```
SYSTEM ARCHITECTURE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SettingsView                 â”‚
â”‚  (UI - User Interaction)             â”‚
â”‚                                      â”‚
â”‚  [Magnetic | Optical] â† picker       â”‚
â”‚  [Start Calibration]                 â”‚
â”‚  [View Preview]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MagnetometerViewModel             â”‚
â”‚  (Unified Detection Interface)       â”‚
â”‚                                      â”‚
â”‚  - detectionMethod: enum             â”‚
â”‚  - revolutions: Int                  â”‚
â”‚  - startMonitoring()                 â”‚
â”‚  - startCalibration()                â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Magnetic   â”‚    â”‚ Optical         â”‚
â”‚ Detector   â”‚    â”‚ Detector        â”‚
â”‚            â”‚    â”‚                 â”‚
â”‚ CoreMotion â”‚    â”‚ AVFoundation    â”‚
â”‚ CMMotion   â”‚    â”‚ Camera          â”‚
â”‚ Manager    â”‚    â”‚ Flashlight      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      Rotation Count
             â†“
      Distance Calculation
             â†“
      Point Saving
```

---

This visual guide should help understand the physical setup and system architecture of the optical wheel detection feature!
